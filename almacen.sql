-- DESCRIPCIÓN DE LAS TABLAS DE LA B.D.

CREATE TABLE PROVINCIAS(
	PROVINCIA NUMBER(2) NOT NULL,
	DESCRIPCION VARCHAR2(20),
	PREFIJO NUMBER(3),
		CONSTRAINT PK_PROVINCIAS PRIMARY KEY(PROVINCIA)
)
/

CREATE TABLE PROVEEDORES(
	PROVEEDOR NUMBER(3) NOT NULL,
	EMPRESA VARCHAR2(25),
	APELLIDOS VARCHAR2(25),
	NOMBRE VARCHAR2(15),
	DIRECCION1 VARCHAR2(25),
	DIRECCION2 VARCHAR2(15),
	POBLACION VARCHAR2(15),
	PROVINCIA NUMBER(2),
	DISTRITO NUMBER(5),
	TELEFONO VARCHAR2(13),
		CONSTRAINT PK_PROVEEDORES PRIMARY KEY(PROVEEDOR),
		CONSTRAINT FK1_PRO_PROVI FOREIGN KEY(PROVINCIA) REFERENCES PROVINCIAS(PROVINCIA),
		CONSTRAINT CK1_EMPRESA CHECK(EMPRESA=UPPER(EMPRESA))
)
/

CREATE TABLE UNIDADES(
	UNIDAD VARCHAR2(2) NOT NULL,
	DESCRIPCION VARCHAR2(10),
		CONSTRAINT PK_UNIDADES PRIMARY KEY(UNIDAD)
)
/

CREATE TABLE ARTICULOS(
	ARTICULO NUMBER(3) NOT NULL,
	PROVEEDOR NUMBER(3) NOT NULL,
	DESCRIPCION VARCHAR2(15),
	PR_VENT NUMBER(9,2) DEFAULT 0,
	PR_COST NUMBER(9,2) DEFAULT 0,
	EXISTENCIAS NUMBER(5) DEFAULT 0,
	SOBRE_MAXIMO NUMBER(5),
	BAJO_MINIMO NUMBER(5),
	FEC_ULT_ENT DATE,
	FEC_ULT_SAL DATE,
	UNIDAD VARCHAR2(2),
		CONSTRAINT PK_ARTICULOS PRIMARY KEY(ARTICULO,PROVEEDOR),
		CONSTRAINT FK1_ART_FOR FOREIGN KEY(UNIDAD) REFERENCES UNIDADES(UNIDAD),
		CONSTRAINT FK2_ART_PRO FOREIGN KEY(PROVEEDOR) REFERENCES PROVEEDORES(PROVEEDOR),
		CONSTRAINT CK1_PR_VENTA CHECK(PR_VENT>PR_COST),
		CONSTRAINT CK2_MAX CHECK(SOBRE_MAXIMO>BAJO_MINIMO+100),
		CONSTRAINT CK3_ENTRADA CHECK(FEC_ULT_ENT>TO_DATE('1/1/2000', 'DD/MM/YYYY')),
		CONSTRAINT CK4_SALIDA CHECK(FEC_ULT_SAL>FEC_ULT_ENT)
)
/

CREATE TABLE FORMPAGOS(
	FORMPAGO VARCHAR2(2) NOT NULL,
	DESCRIPCION VARCHAR2(10),
		CONSTRAINT PK_FORMPAGOS PRIMARY KEY(FORMPAGO)
)
/

CREATE TABLE CLIENTES(
	CLIENTE NUMBER(3) NOT NULL,
	EMPRESA VARCHAR2(25),
	APELLIDOS VARCHAR2(25),
	NOMBRE VARCHAR2(15),
	DIRECCION1 VARCHAR2(25),
	DIRECCION2 VARCHAR2(15),
	POBLACION VARCHAR2(15),
	PROVINCIA NUMBER(2),
	DISTRITO NUMBER(5),
	TELEFONO VARCHAR2(13),
	FORMPAGO VARCHAR2(2),
	TOTAL_FACTURA NUMBER(11,2),
		CONSTRAINT PK_CLIENTES PRIMARY KEY(CLIENTE),
		CONSTRAINT FK1_CLI_FOR FOREIGN KEY(FORMPAGO) REFERENCES FORMPAGOS(FORMPAGO),
		CONSTRAINT FK2_CLI_PROVI FOREIGN KEY(PROVINCIA) REFERENCES PROVINCIAS(PROVINCIA),
		CONSTRAINT CK1_CLI_EMP CHECK(UPPER(EMPRESA)=EMPRESA)
)
/

CREATE TABLE ALBARANES(
	ALBARAN NUMBER(4) NOT NULL,
	CLIENTE NUMBER(3) NOT NULL,
	FECHA_ALBARAN DATE,
	FECHA_ENVIO DATE,
	FECHA_PAGO DATE,
	FORMPAGO VARCHAR2(2),
	ESTADO VARCHAR2(1),
		CONSTRAINT PK_ALBARANES PRIMARY KEY(ALBARAN),
		CONSTRAINT FK1_ALB_FOR FOREIGN KEY(FORMPAGO) REFERENCES FORMPAGOS(FORMPAGO),
		CONSTRAINT FK2_ALB_CLI FOREIGN KEY(CLIENTE) REFERENCES CLIENTES(CLIENTE),
		CONSTRAINT CK1_ENVIO CHECK(FECHA_ENVIO>FECHA_ALBARAN),
		CONSTRAINT CK2_PAGO CHECK(FECHA_PAGO<ADD_MONTHS(FECHA_ENVIO, 3)),-- AÑADIR 3 MESES
		CONSTRAINT CK3_PAGADO CHECK(ESTADO IN('S', 'N'))
)
/

CREATE TABLE LINEAS(
	ALBARAN NUMBER(4) NOT NULL,
	LINEA NUMBER(3) NOT NULL,
	ARTICULO NUMBER(3),
	PROVEEDOR NUMBER(3),
	CANTIDAD NUMBER(5) DEFAULT 0,
	DESCUENTO NUMBER(3) DEFAULT 7,
	PRECIO NUMBER(9,2) DEFAULT 0,
		CONSTRAINT PL_LINEAS PRIMARY KEY(ALBARAN, LINEA),
		CONSTRAINT FK1_LIN_ALB FOREIGN KEY(ALBARAN) REFERENCES ALBARANES(ALBARAN),
		CONSTRAINT FK2_LIN_ART FOREIGN KEY(ARTICULO, PROVEEDOR) REFERENCES ARTICULOS(ARTICULO, PROVEEDOR)
)
/

INSERT INTO PROVINCIAS VALUES(3, 'BONITO', 943)
/

INSERT INTO PROVINCIAS VALUES(4, 'SECO', 944)
/

INSERT INTO PROVEEDORES VALUES(127, 'FRIT RAVICH S.L', 'IRURETAGOIENA', 'MATTIN', 'NAFARROA KALEA 40', 'KALE NAGUSIA 5', 'ZARAUTZ', 3, 245, '943-15-47-63')
/

INSERT INTO PROVEEDORES VALUES(186, 'GONVADOR S.A', 'CORTA', 'JOSE LUIS', 'GOIKO KALEA 5', 'ORAPE KALEA 7', 'MUNDAKA', 4, 189, '944-06-47-83')
/

INSERT INTO UNIDADES VALUES('KG', 'PESADO')
/

INSERT INTO UNIDADES VALUES('GR', 'LIGERO')
/

INSERT INTO ARTICULOS VALUES(46, 127, 'SABOR FRESA', 10, 3.8, 1080, 1400, 250, TO_DATE('07/12/2007', 'DD/MM/YYYY'), TO_DATE('07/12/2008', 'DD/MM/YYYY'), 'KG')
/

INSERT INTO ARTICULOS VALUES(99, 186, 'SABOR MENTA', 12, 7.51, 781, 1200, 89, TO_DATE('23/05/2012', 'DD/MM/YYYY'), TO_DATE('17/08/2013', 'DD/MM/YYYY'), 'GR')
/

INSERT INTO FORMPAGOS VALUES('3', 'AL CONTADO')
/

INSERT INTO FORMPAGOS VALUES('2', 'TRES MESES')
/

INSERT INTO CLIENTES VALUES(405, 'TXIKI PARK', 'MAKAZAGA', 'JON', 'EUSKO GUDARI KALEA 5', 'KAIA KALEA 17', 'ORIO', 3, 187, '943-49-51-37', '3', 1421.69)
/

INSERT INTO CLIENTES VALUES(688, 'KEBAB ZARAUTZ', 'BERNARDO', 'ATXAGA', 'NAFARROA KALEA 8', 'BIZKAIA KALEA 1', 'ZARAUTZ', 4, 167, '944-47-16-24', '2', 2634.52)
/

INSERT INTO ALBARANES VALUES(2463, 405, TO_DATE('23/05/2016', 'DD/MM/YYYY'), TO_DATE('25/05/2016', 'DD/MM/YYYY'), TO_DATE('12/07/2016', 'DD/MM/YYYY'), '2', 'S')
/

INSERT INTO ALBARANES VALUES(3512, 688, TO_DATE('23/05/2016', 'DD/MM/YYYY'), TO_DATE('25/05/2016', 'DD/MM/YYYY'), TO_DATE('26/05/2016', 'DD/MM/YYYY'), '3', 'S')
/

INSERT INTO LINEAS VALUES(2463, 35, 46, 127, 5, 10, 148.45)	
/

INSERT INTO LINEAS VALUES(3512, 21, 99, 186, 12, 11, 257.65)
/